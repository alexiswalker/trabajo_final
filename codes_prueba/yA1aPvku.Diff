
diff -r d3a7caf859cf JbEvain/Cecil/Mono.Cecil.Cil/Document.cs
--- a/JbEvain/Cecil/Mono.Cecil.Cil/Document.cs	Thu Sep 08 06:05:44 2011 +0000
+++ b/JbEvain/Cecil/Mono.Cecil.Cil/Document.cs	Thu Sep 29 13:37:25 2011 +0400
@@ -71,8 +71,9 @@
 		byte language_vendor;
 
 		byte [] hash;
+	    byte [] guid;
 
-		public string Url {
+	    public string Url {
 			get { return url; }
 			set { url = value; }
 		}
@@ -102,10 +103,16 @@
 			set { hash = value; }
 		}
 
-		public Document (string url)
+	    public byte[] Guid {
+	        get { return guid; }
+	        set { guid = value; }
+	    }
+
+	    public Document (string url)
 		{
 			this.url = url;
 			this.hash = Empty<byte>.Array;
+			this.guid = Empty<byte>.Array;
 		}
 	}
 }
diff -r d3a7caf859cf JbEvain/Cecil/Mono.Cecil.Mdb/MdbReader.cs
--- a/JbEvain/Cecil/Mono.Cecil.Mdb/MdbReader.cs	Thu Sep 08 06:05:44 2011 +0000
+++ b/JbEvain/Cecil/Mono.Cecil.Mdb/MdbReader.cs	Thu Sep 29 13:37:25 2011 +0400
@@ -125,6 +125,8 @@
 				return document;
 
 			document = new Document (file_name);
+		    document.Guid = file.Guid ?? Empty<byte>.Array;
+		    document.Hash = file.Hash ?? Empty<byte>.Array;
 			documents.Add (file_name, document);
 
 			return document;
diff -r d3a7caf859cf JbEvain/Cecil/Mono.Cecil.Mdb/MdbWriter.cs
--- a/JbEvain/Cecil/Mono.Cecil.Mdb/MdbWriter.cs	Thu Sep 08 06:05:44 2011 +0000
+++ b/JbEvain/Cecil/Mono.Cecil.Mdb/MdbWriter.cs	Thu Sep 29 13:37:25 2011 +0400
@@ -81,7 +81,7 @@
 			if (source_files.TryGetValue (url, out source_file))
 				return source_file;
 
-			var entry = writer.DefineDocument (url);
+			var entry = writer.DefineDocument (url, document.Guid, document.Hash);
 			var compile_unit = writer.DefineCompilationUnit (entry);
 
 			source_file = new SourceFile (compile_unit, entry);
diff -r d3a7caf859cf JbEvain/Cecil/Mono.CompilerServices.SymbolWriter/MonoSymbolTable.cs
--- a/JbEvain/Cecil/Mono.CompilerServices.SymbolWriter/MonoSymbolTable.cs	Thu Sep 08 06:05:44 2011 +0000
+++ b/JbEvain/Cecil/Mono.CompilerServices.SymbolWriter/MonoSymbolTable.cs	Thu Sep 29 13:37:25 2011 +0400
@@ -706,7 +706,7 @@
 			bw.Write (file_name);
 
 			if (guid == null) {
-				guid = Guid.NewGuid ().ToByteArray ();
+				guid = System.Guid.NewGuid ().ToByteArray ();
 				try {
 					using (FileStream fs = new FileStream (file_name, FileMode.Open, FileAccess.Read)) {
 						MD5 md5 = MD5.Create ();
@@ -754,6 +754,14 @@
 			get { return auto_generated; }
 		}
 
+		public byte[] Hash {
+			get { return hash; }
+		}
+
+		public byte[] Guid {
+			get { return guid; }
+		}
+
 		public void SetAutoGenerated ()
 		{
 			if (!creating)