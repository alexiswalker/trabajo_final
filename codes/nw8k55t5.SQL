--wypisac osobe ktora nie miala zadnego pierniczka upieczonego
--choinke ktora miala minimalna liczbe pierniczkow zawieszona i jej wzrost
--osobe ktora zrobila najwiecej pierniczkow

SELECT * 
FROM OSOBY 
LEFT JOIN PIERNICZKI ON PIERNICZKI.PESEL_OSOBY = OSOBY.PESEL
WHERE PIERNICZKI.PESEL_OSOBY IS NULL

SELECT TOP 1 OSOBY.PESEL, COUNT(OSOBY.PESEL)
FROM OSOBY
INNER JOIN PIERNICZKI ON PIERNICZKI.PESEL_OSOBY = OSOBY.PESEL
GROUP BY OSOBY.PESEL
ORDER BY COUNT(OSOBY.PESEL) DESC

SELECT OSOBY.PESEL, COUNT(OSOBY.PESEL)
FROM OSOBY
INNER JOIN PIERNICZKI ON PIERNICZKI.PESEL_OSOBY = OSOBY.PESEL
GROUP BY OSOBY.PESEL
HAVING COUNT(OSOBY.PESEL) = (
				SELECT MAX(A.CNT)
				FROM (
						SELECT COUNT(OSOBY.PESEL) AS CNT
						FROM OSOBY
						INNER JOIN PIERNICZKI ON PIERNICZKI.PESEL_OSOBY = OSOBY.PESEL
						GROUP BY OSOBY.PESEL
						) AS A
				)

SELECT *
FROM OSOBY
WHERE NOT EXISTS (
    SELECT PIERNICZKI.PESEL_OSOBY
    FROM PIERNICZKI
    WHERE OSOBY.PESEL = PIERNICZKI.PESEL_OSOBY
)

SELECT CHOINKI.ID, COUNT(CHOINKI.ID) AS LICZBA_PLACKOW
FROM CHOINKI
LEFT JOIN PIERNICZKI ON PIERNICZKI.CH_ID = CHOINKI.ID
GROUP BY CHOINKI.ID
HAVING COUNT(CHOINKI.ID) = (SELECT MIN(CNT.C)
							FROM(SELECT COUNT(CHOINKI.ID) AS C
								FROM CHOINKI
								LEFT JOIN PIERNICZKI ON PIERNICZKI.CH_ID = CHOINKI.ID
								GROUP BY CHOINKI.ID) AS CNT
						)